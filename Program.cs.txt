#region Defining Variables and Arrays

using System.Xml.Linq;

Items keyToMaster = new Items { name = "Key to Master Room", isInInv = false };

Room[] Rooms = new Room[8];

Rooms[0] = new Room
{
    identifier = 0,
    name = "General Space",
    roomDesc = "Main Enterence and A corridor to access all rooms",
    isLocked = false
};

Rooms[1] = new Room
{
    identifier = 1,
    name = "Storage",
    roomDesc = "Storage room and Laundy machine",
    isLocked = false
};

Rooms[2] = new Room
{
    identifier = 2,
    name = "Living Room",
    roomDesc = "Living room includes TV, Sofa, Clock, coffee table etc..",
    isLocked = false
};

Rooms[3] = new Room
{
    identifier = 3,
    name = "Kitchen",
    roomDesc = "Kithcen includes Induction, Mixer, Dining Table, Fridge, Utensils, Dishwasher etc..",
    isLocked = false
};
Rooms[4] = new Room
{
    identifier = 4,
    name = "Washroom1",
    roomDesc = "Washroom 1 with Washbasin.",
    isLocked = false
};
Rooms[5] = new Room
{
    identifier = 5,
    name = "Washroom2",
    roomDesc = "Washroom 2 with Washbasin.",
    isLocked = false
};
Rooms[6] = new Room
{
    identifier = 6,
    name = "Master Room",
    roomDesc = "Master Bedroom with huge space, balcony, Coffee table, sofa, AC, Heater, Lamp, TV, etc...",
    isLocked = true,
    specialCondition = "Key to Master Room"
};

Rooms[7] = new Room
{
    identifier = 7,
    name = "Bedroom",
    roomDesc = "Bedroom with small space, AC, Heater, Lamp",
    isLocked = false,
    items = new Items[] { keyToMaster }
};

Rooms[0].connections = new Room[] { Rooms[1], Rooms[2], Rooms[3], Rooms[4], Rooms[5], Rooms[6], Rooms[7] };
Rooms[1].connections = new Room[] { Rooms[0] };
Rooms[2].connections = new Room[] { Rooms[0] };
Rooms[3].connections = new Room[] { Rooms[0] };
Rooms[4].connections = new Room[] { Rooms[0] };
Rooms[5].connections = new Room[] { Rooms[0] };
Rooms[6].connections = new Room[] { Rooms[0] };
Rooms[7].connections = new Room[] { Rooms[0] };



Player player = new Player
{
    identifier = "Drhuv",
    position = Rooms[0],
    inventory = new Items[] { null }
};


#endregion

#region Main Loop

int rounds = 0;
while (true)
{
    bool playerChooseRoom = false;
    bool playerChooseItem = false;
    Console.Clear();
    if (rounds == 0) writeGameinfo(player, start: true);
    else writeGameinfo(player);
    WriteRoomInfo(player.position);
    writeRoomOptions(player.position);

    Console.Write($"Select a room to enter \n >>> ");
    string userInput = (Console.ReadLine()!);
    int intUserInput;

    int optionsCounter = player.position.connections.Length;
    if (player.position.items is not null)
    {
        foreach (Items item in player.position.items)
        {
            if (item is not null && !item.isInInv) optionsCounter++;
        }
    }

    while (!TryValidateInput(userInput, out intUserInput, optionsCounter))
    {
        Console.WriteLine($"Invalid input. Choose a integer between 1 and {optionsCounter}");
        userInput = (Console.ReadLine()!);
    }

    int finalInput;

    if (intUserInput <= player.position.connections.Length) { playerChooseRoom = true; finalInput = intUserInput; }
    else { playerChooseItem = true; finalInput = intUserInput - player.position.connections.Length; }

    // player.position = Rooms[intUserInput - 1];
    if (playerChooseRoom)
    {
        if (player.position.connections[finalInput - 1].isLocked)
        {
            Console.WriteLine("This door is locked!");
            foreach (Items item in player.inventory)
            {
                if (item is not null && item.name == player.position.connections[finalInput - 1].specialCondition)
                {
                    player.position.connections[finalInput - 1].isLocked = false;
                    Console.WriteLine($"you used {item.name} to unlock it!");
                    player.position = player.position.connections[finalInput - 1];
                }
            }
            Console.WriteLine("Press ENTER to continue");
            Console.ReadLine();
        }
        else
        {
            player.position = player.position.connections[finalInput - 1];
        }
    }
    if (playerChooseItem)
    {
        int i = 0;
        foreach (Items item in player.inventory)
        {
            if (item is null)
            {
                player.inventory[i] = player.position.items[finalInput - 1];
                player.position.items[finalInput - 1].isInInv = true;
                i++;
            }

        }
    }
    rounds++;
}

#endregion

#region Functions

void writeGameinfo(Player player, bool start = false)
{
    if (start)
    {
        Console.ForegroundColor = ConsoleColor.Red;
        Console.WriteLine(" ==========================");
        Console.WriteLine(" =====- A.R.D Escape -=====");
        Console.WriteLine(" ==========================");
        Console.ResetColor();
    }
    else
    {
        Console.ForegroundColor = ConsoleColor.Red;
        Console.WriteLine(" =====- A.R.D Escape -=====");
        Console.WriteLine($"{player.identifier}'s Inventory: ");
        foreach (Items item in player.inventory)
        {
            if (item is not null) { Console.WriteLine($"[ {item.name} ] "); }
        }
        Console.WriteLine();
        Console.ResetColor();
    }

}

bool TryValidateInput(string userInput, out int intUserInput, int length)
{
    int integer;
    if (int.TryParse(userInput, out integer))
    {
        if (integer > 0 && integer <= length)
        {
            intUserInput = integer;
            return true;
        }
    }
    intUserInput = 0;
    return false;
}

void WriteRoomInfo(Room room)
{
    Console.ForegroundColor = ConsoleColor.Red;
    Console.WriteLine($"-= {room.name} =-");
    Console.ForegroundColor = ConsoleColor.Yellow;
    Console.WriteLine($"{room.roomDesc}\n Connected Rooms:\n");
    Console.ResetColor();
}

void writeRoomOptions(Room room)
{
    int i = 1;
    Console.ForegroundColor = ConsoleColor.Green;
    foreach (Room connectedRoom in room.connections)
    {
        Console.WriteLine($"[ {i} ]: {connectedRoom.name}");
        i++;
    }
    Console.ForegroundColor = ConsoleColor.Blue;
    if (room.items is not null)
    {
        foreach (Items item in room.items)
        {
            if (!item.isInInv) Console.WriteLine($"[ {i} ]: {item.name}");
        }
        Console.ResetColor();
    }
}

#endregion

#region Classes

class Room
{
    public int identifier;
    public string name;
    public string roomDesc;
    public Room[] connections;
    public Items[] items;
    public bool isLocked;
    public string specialCondition;
}

class Player
{
    public string identifier;
    public Room position;
    public Items[]? inventory;
}

class Items
{
    public string name;
    public bool isInInv;
}

#endregion